# tskit C sources & objects
# TSKIT_SOURCES = $(wildcard tskit/*.c) # wildcard is a GNU extension and not desired on CRAN
TSKIT_SOURCES = \
	tskit/convert.c \
	tskit/core.c \
	tskit/genotypes.c \
	tskit/haplotype_matching.c \
	tskit/kastore.c \
	tskit/stats.c \
	tskit/tables.c \
	tskit/trees.c
# $(info TSKIT_SOURCES = $(TSKIT_SOURCES)) # for debugging, info is also a GNU extension
TSKIT_OBJECTS = $(TSKIT_SOURCES:.c=.o)
# $(info TSKIT_OBJECTS = $(TSKIT_OBJECTS)) # for debugging, info is also a GNU extension

# RcppTskit C/C++ sources & objects
RCPPTSKIT_C_SOURCES = \
	test_tsk_abort_stderr_c.c
# $(info RCPPTSKIT_C_SOURCES = $(RCPPTSKIT_C_SOURCES)) # for debugging, info is also a GNU extension
# RCPPTSKIT_CPP_SOURCES = $(wildcard *.cpp) # wildcard is a GNU extension and not desired on CRAN
RCPPTSKIT_CPP_SOURCES = \
	RcppTskit.cpp \
	test_tsk_abort_stderr.cpp \
	RcppExports.cpp
# $(info RCPPTSKIT_CPP_SOURCES = $(RCPPTSKIT_CPP_SOURCES)) # for debugging, info is also a GNU extension
RCPPTSKIT_OBJECTS = $(RCPPTSKIT_C_SOURCES:.c=.o) $(RCPPTSKIT_CPP_SOURCES:.cpp=.o)
# $(info RCPPTSKIT_OBJECTS = $(RCPPTSKIT_OBJECTS)) # for debugging, info is also a GNU extension

# All objects
OBJECTS = $(TSKIT_OBJECTS) $(RCPPTSKIT_OBJECTS)
# $(info OBJECTS = $(OBJECTS)) # for debugging, info is also a GNU extension

# Include paths and preprocessor defines
# * A bit complicated include/tskit structure due to how we include tskit headers
# * $(R_INCLUDE_DIR) is for <R_ext/Error.h>
PKG_CPPFLAGS = \
	-I../inst/include \
	-I../inst/include/tskit \
	-I../inst/include/tskit/tskit \
	-I$(R_INCLUDE_DIR)

# Compiler flags
PKG_CFLAGS = -DNDEBUG # to remove calls to assert() as per the R extensions manual
# PKG_CFLAGS = -DNDEBUG -DTSK_TRACE_ERRORS # to also enable error tracing in tskit C
# PKG_CXXFLAGS = -DTSK_TRACE_ERRORS # to also enable error tracing in tskit C as called from Rcpp

# Explicit compile rule for tskit C files
tskit/%.o: tskit/%.c
	$(CC) $(ALL_CPPFLAGS) $(PKG_CFLAGS) $(CFLAGS) $(CPICFLAGS) -c $< -o $@

# Linking
PKG_LIBS = @RCPPTSKIT_LIB@
