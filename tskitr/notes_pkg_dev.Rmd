# Notes on R package development

## Next TODOs

* TODO: Rename ts_load() to ts_load_ptr() and create ts_load() returning S3/S4/R6 object #22
        https://github.com/HighlanderLab/tskitr/issues/22

## Setup

```
install.packages(c("usethis", "devtools"))
```

## Code testing coverage with covr

```
install.packages("covr")

# https://usethis.r-lib.org/reference/use_coverage.html
usethis::use_coverage(type = "codecov")

# Build the report
cov <- covr::package_coverage(clean = TRUE)

# Interactive HTML report with uncovered lines highlighted
covr::report(cov)

# List lines with zero coverage per file
covr::zero_coverage(cov)

# Show coverage for a specific file
covr::report(cov, file = "R/tskitr-package.R")
covr::report(cov, file = "src/tskitr_minimal.cpp")

# If you want a quick text view of uncovered lines:
covr::file_coverage("R/tskitr-package.R", "tests/testthat")
covr::file_coverage("src/tskitr_minimal.cpp", "tests/testthat")
```

To ignore specific lines, use `# nocov`

To ignore multiple lines use `# nocov start/stop`.

In `Rcpp` code use `// # nocov ...`.

## Air formatter

https://usethis.r-lib.org/reference/use_air.html
```
usethis::use_air()
```

## Jarl linter and fixer (buil on Air)

https://jarl.etiennebacher.com

* Add jarl.toml to ~/.config/jarl and to the package folder
* TODO

## GitHub actions

```
install.packages("usethis")

# R CMD check
usethis::use_github_action("check-standard")

# Code testing coverage with covr
usethis::use_github_action("test-coverage")

# Air formatting
usethis::use_github_action(url = "https://github.com/posit-dev/setup-air/blob/main/examples/format-suggest.yaml")
usethis::use_github_action(url = "https://github.com/posit-dev/setup-air/blob/main/examples/format-check.yaml")
```
